<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UPSC CMS Dashboard | upscools</title>

  <!-- Quill CSS -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: 'Arial', sans-serif; margin: 0; background: #f4f7f8; }
    header { background: #0077cc; color: #fff; padding: 15px; text-align: center; font-size: 1.5rem; font-weight: bold; }
    .dashboard { display: flex; min-height: 100vh; }
    .sidebar { width: 220px; background: #005fa3; color: #fff; display: flex; flex-direction: column; }
    .sidebar button { padding: 15px; border: none; background: transparent; color: #fff; text-align: left; cursor: pointer; font-size: 1rem; border-bottom: 1px solid #0077cc; }
    .sidebar button.active { background: #0077cc; }
    .main { flex: 1; padding: 30px; overflow-y: auto; }
    h2 { margin-top: 0; }
    form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input, textarea, select { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #ccc; }
    button.save-btn { padding: 10px 25px; background: #28a745; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
    button.save-btn:hover { background: #218838; }
    #blog-content-editor { height: 300px; margin-bottom: 15px; }
  </style>
</head>
<body>

<header>UPSC CMS Dashboard</header>

<div class="dashboard">
  <!-- Sidebar Tabs -->
  <div class="sidebar">
    <button class="tab-btn active" data-target="blog-section">Blogs</button>
    <button class="tab-btn" data-target="subjects-section">Subjects</button>
    <button class="tab-btn" data-target="pages-section">Pages</button>
  </div>

  <!-- Main Content -->
  <div class="main">
    <!-- Blogs Section -->
    <div id="blog-section" class="cms-section active">
      <h2>Manage Blogs</h2>
      <form id="blog-form">
        <label>Slug (unique URL ID):</label>
        <input type="text" id="blog-slug" placeholder="e.g., prepare-upsc-1-year" required>

        <label>Title:</label>
        <input type="text" id="blog-title" required>

        <label>Excerpt:</label>
        <textarea id="blog-excerpt" placeholder="Short summary for blog card" required></textarea>

        <label>Content (Rich Text Editor):</label>
        <div id="blog-content-editor"></div>

        <label>Author:</label>
        <input type="text" id="blog-author" placeholder="Your name">

        <label>Date:</label>
        <input type="date" id="blog-date">

        <button type="submit" class="save-btn">Save Blog</button>
      </form>
    </div>

    <!-- Subjects Section -->
    <div id="subjects-section" class="cms-section" style="display:none;">
      <h2>Manage Subjects</h2>
      <form id="subjects-form">
        <label>Subject Name:</label>
        <input type="text" id="subject-name" placeholder="e.g., History" required>

        <label>Description:</label>
        <textarea id="subject-desc" placeholder="Description of the subject" style="height:150px;"></textarea>

        <button type="submit" class="save-btn">Save Subject</button>
      </form>
    </div>

    <!-- Pages Section -->
    <div id="pages-section" class="cms-section" style="display:none;">
      <h2>Manage Other Pages</h2>
      <form id="pages-form">
        <label>Page ID (unique):</label>
        <input type="text" id="page-id" placeholder="e.g., about" required>

        <label>Title:</label>
        <input type="text" id="page-title" required>

        <label>Content (HTML allowed):</label>
        <textarea id="page-content" placeholder="<p>Full page content</p>" style="height:200px;"></textarea>

        <button type="submit" class="save-btn">Save Page</button>
      </form>
    </div>
  </div>
</div>

<!-- Firebase + Quill Scripts -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, setDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBF3pyZBPfCyr5V0RF0Q2of33JWNWo3-XA",
    authDomain: "upscools.firebaseapp.com",
    projectId: "upscools",
    storageBucket: "upscools.appspot.com",
    messagingSenderId: "904130312850",
    appId: "1:904130312850:web:7ea707ef3e8d2c98b3444b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ---------- Tab Logic ----------
  const tabButtons = document.querySelectorAll(".tab-btn");
  const sections = document.querySelectorAll(".cms-section");

  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      tabButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      sections.forEach(sec => sec.style.display = 'none');
      document.getElementById(btn.dataset.target).style.display = 'block';
    });
  });

  // ---------- Initialize Quill Editor ----------
  const quill = new Quill('#blog-content-editor', {
    theme: 'snow',
    placeholder: 'Write your blog content here...',
    modules: {
      toolbar: [
        [{ header: [1, 2, 3, false] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ list: 'ordered' }, { list: 'bullet' }],
        ['link', 'image'],
        ['clean']
      ]
    }
  });

  // ---------- Blog Form ----------
  document.getElementById("blog-form").addEventListener("submit", async e => {
    e.preventDefault();
    const slug = document.getElementById("blog-slug").value.trim();
    const title = document.getElementById("blog-title").value.trim();
    const excerpt = document.getElementById("blog-excerpt").value.trim();
    const content = quill.root.innerHTML;
    const author = document.getElementById("blog-author").value.trim() || "Admin";
    const dateValue = document.getElementById("blog-date").value;
    const date = dateValue ? Timestamp.fromDate(new Date(dateValue)) : Timestamp.now();

    if (!slug || !title || !excerpt || !content) return alert("Please fill all required fields.");

    try {
      await setDoc(doc(db, "blogPosts", slug), { title, slug, excerpt, content, author, date });
      alert("Blog saved successfully!");
      document.getElementById("blog-form").reset();
      quill.setContents([]);
    } catch (err) {
      console.error(err);
      alert("Error saving blog.");
    }
  });

  // ---------- Subjects Form ----------
  document.getElementById("subjects-form").addEventListener("submit", async e => {
    e.preventDefault();
    const name = document.getElementById("subject-name").value.trim();
    const desc = document.getElementById("subject-desc").value.trim();
    if (!name) return alert("Enter subject name.");
    try { await setDoc(doc(db, "subjects", name), { name, desc }); alert("Subject saved!"); document.getElementById("subjects-form").reset(); } 
    catch(err) { console.error(err); alert("Error saving subject."); }
  });

  // ---------- Pages Form ----------
  document.getElementById("pages-form").addEventListener("submit", async e => {
    e.preventDefault();
    const pageId = document.getElementById("page-id").value.trim();
    const title = document.getElementById("page-title").value.trim();
    const content = document.getElementById("page-content").value.trim();
    if (!pageId || !title || !content) return alert("Fill all fields.");
    try { await setDoc(doc(db, "sitePages", pageId), { title, content }); alert("Page saved!"); document.getElementById("pages-form").reset(); } 
    catch(err) { console.error(err); alert("Error saving page."); }
  });
</script>

</body>
</html>

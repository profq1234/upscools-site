<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Blog CMS | upscools</title>

<!-- Quill Editor CSS -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<!-- Custom CSS -->
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f9f9f9;
  color: #333;
  margin: 0;
  padding: 0;
}

h1 {
  text-align: center;
  margin: 2rem 0;
  color: #222;
}

form#blog-form {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 2rem;
  border-radius: 10px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

label {
  font-weight: 600;
  margin-bottom: 0.5rem;
}

input[type="text"], input[type="date"], textarea {
  width: 100%;
  padding: 0.8rem;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 1rem;
  box-sizing: border-box;
}

textarea {
  min-height: 100px;
  resize: vertical;
}

#editor-container {
  background: #fff;
  min-height: 400px;
}

button {
  background: #1e90ff;
  color: #fff;
  border: none;
  padding: 1rem;
  font-size: 1.1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
  margin-top: 1rem;
}

button:hover {
  background: #0d6efd;
}

@media (max-width: 600px) {
  form#blog-form {
    padding: 1rem;
  }
}
</style>
</head>
<body>
<h1>UPSC Blog CMS</h1>

<form id="blog-form">
  <div>
    <label>Slug (unique URL ID):</label>
    <input type="text" id="slug" required placeholder="e.g., prepare-upsc-1-year" />
  </div>

  <div>
    <label>Title:</label>
    <input type="text" id="title" required />
  </div>

  <div>
    <label>Excerpt:</label>
    <textarea id="excerpt" required placeholder="Short summary for blog card"></textarea>
  </div>

  <div>
    <label>Content (Rich Text Editor):</label>
    <div id="editor-container"></div>
  </div>

  <div>
    <label>Author:</label>
    <input type="text" id="author" placeholder="Your name" />
  </div>

  <div>
    <label>Date:</label>
    <input type="date" id="date" />
  </div>

  <button type="submit">Save Blog</button>
</form>

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>

<!-- Firebase + CMS Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBF3pyZBPfCyr5V0RF0Q2of33JWNWo3-XA",
  authDomain: "upscools.firebaseapp.com",
  projectId: "upscools",
  storageBucket: "upscools.appspot.com",
  messagingSenderId: "904130312850",
  appId: "1:904130312850:web:7ea707ef3e8d2c98b3444b"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Initialize Quill
const quill = new Quill('#editor-container', {
  theme: 'snow',
  placeholder: 'Write your blog content here...',
  modules: {
    toolbar: [
      [{ header: [1, 2, 3, false] }],
      ['bold', 'italic', 'underline', 'strike'],
      [{ list: 'ordered'}, { list: 'bullet' }],
      ['link', 'image'],
      ['clean']
    ]
  }
});

// Form submission
const form = document.getElementById("blog-form");
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const slug = document.getElementById("slug").value.trim();
  const title = document.getElementById("title").value.trim();
  const excerpt = document.getElementById("excerpt").value.trim();
  const content = quill.root.innerHTML.trim();
  const author = document.getElementById("author").value.trim() || "Admin";
  const dateValue = document.getElementById("date").value;
  const date = dateValue ? Timestamp.fromDate(new Date(dateValue)) : Timestamp.now();

  if (!slug || !title || !excerpt || !content) {
    alert("Please fill all required fields.");
    return;
  }

  try {
    await setDoc(doc(db, "blogPosts", slug), {
      title,
      slug,
      excerpt,
      content,
      author,
      date
    });
    alert(`Blog saved successfully!`);
    form.reset();
    quill.setContents([]); // clear editor
  } catch (error) {
    console.error("Error saving blog:", error);
    alert("Error saving blog. Check console for details.");
  }
});
</script>
</body>
</html>
